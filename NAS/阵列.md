# 阵列的分类

## Single Disk

## RAID0
	
## RAID 1

## RAID 10

## RAID 5

## RAID 6

## TRAID

## TRAID+

---

# 阵列的状态

## 1. 正常状态
- 阵列冗余完整、数据一致
- 这时通常**数据清理/校验**等维护功能才会开放
- ‘存储池状态为正常’
## 2. 进行中
- 同步中
- 重建中
- 初始化中
- 扩容中
- 数据清理中
## 3. 降阶
**故障原因：**  
阵列中某个硬盘出现故障，导致该硬盘从阵列中脱离，从而导致阵列降级。  

---
## 4. RAID统计表

| 存储池类型               |  最少需要几块盘 | 移除几块会“降阶”（还能用）             | 移除几块会“损坏/不可用”              | 关键说明                                             |      |
| ------------------- | -------: | -------------------------- | -------------------------- | ------------------------------------------------ | ---- |
| **Single（单盘）**      |        1 | 不存在“降阶”                    | **1**（盘没了数据就没了）            | 无冗余                                              |      |
| **JBOD（拼接）**        |        2 | **严格来说不叫降阶**（因为无冗余）        | **1** 也会产生“数据损坏/不完整”风险     | 掉一块盘，**这块盘上的数据必丢**；若卷/文件系统跨盘拼接，常见表现是卷不可挂载或大量文件损坏 |      |
| **RAID 0（条带）**      |        2 | 不存在“降阶”                    | **1**（全阵列数据都没）             | 无冗余，任何一盘出问题都完                                    |      |
| **RAID 1（镜像）**      |        2 | **1 ~ (N-1)**（只要还剩 ≥1 盘）   | **N**（全部盘都没/都坏）            | N=阵列总盘数；RAID1 盘越多，可容忍失效盘越多                       |      |
| **RAID 5（条带+单校验）**  |        3 | **1**                      | **2**                      | 允许掉 1 盘；再掉 1 盘就超过校验能力                            |      |
| **RAID 6（条带+双校验）**  |        4 | **1 ~ 2**                  | **3**                      | 允许掉 2 盘；第 3 盘掉了就完                                |      |
| **RAID 10（条带+镜像）**  | 4（且必须偶数） | **只要某一“镜像对”坏 1 块就降阶**      | **任意一个镜像对坏 2 块（同一对全没）就损坏** | 它不是按“掉几块盘”简单计数，而是看**掉的盘是否落在同一镜像对**               |      |
| **TRAID（灵活阵列）**     |        2 | **当盘数≥2时：1（不全，要具体情况具体考虑）** | **当盘数≥2时：2**               | 盘数=1 时等同“单盘”无冗余；盘数≥2 时允许掉 1 盘                    |      |
| **TRAID+（双冗余灵活阵列）** |        4 | **1 ~ 2**                  | **3**                      | 类似 RAID6：允许掉 2 盘                                 |      |
| 阵列类型                |     阵列修复 | 添加磁盘                       | 阵列迁移                       | 更换磁盘（阵列扩容）                                       | 数据清理 |
| SingleDisk          |        ❌ | ❌                          | ✅                          | ❌                                                | ❌    |
| JBOD                |        ❌ | ✅                          | ❌                          | ❌                                                | ❌    |
| RAID 1              |        ✅ | ❌                          | ✅                          | ✅                                                | ❌    |
| RAID 5              |        ✅ | ✅                          | ✅                          | ✅                                                | ❌    |
| RAID 6              |        ✅ | ✅                          | ❌                          | ✅                                                | ❌    |
| RAID 10             |        ✅ | ❌                          | ❌                          | ✅                                                | ❌    |
| TRAID（单盘）           |        ❌ | ✅                          | ✅                          | ❌                                                | ❌    |
| TRAID（非单盘）          |        ✅ | ✅                          | ✅                          | ✅                                                | ❌    |
| TRAID+              |        ✅ | ✅                          | ❌                          | ✅                                                | ❌    |
# 阵列的功能

## 1. 阵列修复
**定义：**  
当阵列因为**成员盘故障/掉线/缺失**进入**降阶（Degraded）**后，通过插入/指定一块可用磁盘作为替代盘，系统按阵列冗余规则（镜像/校验）**重建缺失的数据与校验信息**，使阵列从“降阶”恢复到“正常（Healthy/Normal）”。

**一句话理解：**坏盘被替换后，把冗余“补回来”。
## 2. 添加磁盘
**定义：**  
在阵列/存储池中**新增一块成员盘**（不替换现有盘），系统把新盘纳入阵列结构，并对条带/校验布局进行调整，从而**提升阵列可用容量**（通常也会触发后台数据重分布/扩容过程）。

**一句话理解：**有空槽位就“加一块盘进阵列”，容量变大。
## 3. 阵列迁移
**定义：**  
在尽量保留现有数据的前提下，将阵列从一种组织方式**转换为另一种组织方式**（例如从单盘/RAID1 迁移到 RAID5/TRAID，或从 RAID5 提升到更高冗余方案等，具体迁移路径以系统支持为准）。迁移会改变阵列的冗余策略、条带结构或容量利用方式。

**一句话理解：**不只是扩容，而是把阵列“换一种 RAID 形态”。
## 4. 更换磁盘（阵列扩容）
**定义：**  
在不增加阵列盘数的情况下，通过将阵列中的旧盘**逐块替换为更大容量的新盘**，并在每次替换后执行重建；当达到系统扩容条件后，阵列把可用容量提升到新的规模（必要时还需在卷/文件系统层完成容量扩展）。

**一句话理解：**盘位满了就“逐块换大盘”，靠多次重建把容量做大。
## 5. 数据清理
**定义：**  
在阵列处于正常状态时，对阵列数据进行**一致性校验与介质扫描**：系统顺序读取数据块并校验镜像/校验信息，发现不一致或潜在读错误时，尽可能利用冗余信息进行纠正，从而降低“静默错误/位翻转/坏块”导致的数据风险。

> 注意：这不是删除数据，“清理”指的是校验/修复一致性。

**一句话理解：**阵列健康维护：定期“体检 + 纠错”。




---

# 更换阵列中出现故障的硬盘_论坛

**适用版本:**  
所有版本  
  
**适用机型：**  
所有 TNAS 型号  
  
**故障现象：**  
TOS消息中心提示“阵列降级”，并且NAS持续发出蜂鸣声。  
![图片](https://s2.loli.net/2024/11/05/S4qTMKPrbA5Nw26.png)  
  
**故障原因：**  
阵列中某个硬盘出现故障，导致该硬盘从阵列中脱离，从而导致阵列降级。  
  
**解决办法：**  
一、根据TOS消息中心的提示，记录有故障有硬盘。短按开关按钮关闭NAS，待电源灯指示灯熄灭，取出故障硬盘。插入新的硬盘并确保插入的新硬盘容量大于或等于阵列中容量最小的硬盘的容量  
  
二、短按开关按钮开启NAS，导航至 控制面板>存储管理>存储池 点击 “编辑”按钮，在弹出的菜单中，选择“阵列修复”修复阵列，此过程可能需要一些时间，请耐心等待直至其修复完成。如下图：  
![图片](https://s2.loli.net/2024/11/05/tlh56TbArecxK4F.png)  
  
注意：本解决方法仅适用于TRAID、TRAID+、RAID1、RAID5、RAID6、RAID10等阵列类型，如遇任何问题或不确定如何操作，请咨询官网在线客服。

# “为阵列添加磁盘”、“阵列在线迁移”、“阵列扩容”_论坛

TOS 系统 关于“为阵列添加磁盘”、“阵列在线迁移”、“阵列扩容”的说明和操作步骤  
  
**适用型号**：  
所有TNAS 型号  
  
**“为阵列添加磁盘”**  
适用阵列类型：TRAID、TRAID+、JBOD、RAID 5、RAID 6。  
在不改变阵列模式的前提下，通过为现有阵列添加磁盘，增加阵列(存储池)的容量。  
  
操作步骤：  
1. 短按电源按钮关闭 TNAS。等到电源指示灯熄灭，在 TNAS 中插入一块新的磁盘并确保插入的新磁盘容量大于或等于阵列中容量最小的磁盘的容量；  
2. 短按电源按钮开启 TNAS。前往 控制面板 > 存储管理 > 存储池 > 编辑 > 为阵列添加磁盘 > 选择磁盘 > 确认设置；  
3. 前往 控制面板>存储管理>卷 点击 “编辑”按钮，根据需求编辑卷容量。  
  
备注：  
阵列编辑只能一次添加一块新硬盘,不可同时添加两块或更多硬盘。  
同步完成后如果发现依然无法扩容存储池或卷,请参考这个指引,手动扩容:  
[viewtopic.php?f=88&t=1579](https://forum.terra-master.com/cn/viewtopic.php?f=88&t=1579)  
  
[![图片](https://s2.loli.net/2024/11/29/yCE48DzNePU16gr.png)](https://sm.ms/image/yCE48DzNePU16gr)  
  
**“阵列在线迁移”**  
适用阵列类型：TRAID、Single、RAID 1、RAID 5。  
在保留当前数据的前提下，将现有阵列模式升级到更高安全级别的 RAID 模式。迁移需要向 TNAS 中添加磁盘，且新增磁盘的容量需不小于当前阵列中最小磁盘的容量。  
  
阵列迁移需按此顺序 Single > RAID 1, RAID 1 > RAID 5, RAID 5 > RAID 6，不可跳跃。  
无法从其它阵列迁移至 RAID 10，只能在 TOS 创建阵列时创建 RAID 10。  
  
[![图片](https://s2.loli.net/2024/11/29/juyxYW3UDetbTJO.png)](https://sm.ms/image/juyxYW3UDetbTJO)  
TRAID 迁移到 TRAID+ 的操作步骤：  
请参考以下链接  
[viewtopic.php?t=4397](https://forum.terra-master.com/cn/viewtopic.php?t=4397)  
  
其它阵列类型迁移的操作步骤：  
4. 短按电源按钮关闭 TNAS。等到电源指示灯熄灭，插入一块新的磁盘，容量不小于现有阵列中容量最小的磁盘；  
5. 短按电源按钮开启 TNAS。前往 控制面板 > 存储管理 > 存储池 > 编辑 > 阵列在线迁移 > 选择磁盘 > 确认设置；  
6. 前往 TOS 控制面板 > 存储管理 > 卷 > 编辑 ，根据需求编辑卷容量。  
  
**“阵列扩容”**  
适用阵列类型：TRAID、TRAID+、RAID 1、RAID 5、RAID 6。  
在不改变阵列中磁盘总数的前提下，将较小容量的磁盘更换为更大容量的磁盘，让阵列增加更多的可用容量。  
  
操作步骤：  
7. 短按电源按钮关闭 TNAS。等到电源指示灯熄灭，取出要更换的磁盘，然后插入容量更大的磁盘。  
8. 短按电源按钮开启 TNAS。您会听到连续"滴滴"的蜂鸣声，此时消息中心会汇报阵列降阶的消息，请前往 TOS 桌面右侧关闭蜂鸣器。  
9. 前往 TOS 控制面板 > 存储管理 > 存储池(此时显示为阵列降阶) > 编辑 > 选择阵列扩容 > 选择新添加的磁盘 > 确认设置。  
10. 如果您需要替换多块磁盘，请等待阵列同步完成后，重复第1、2、3步骤。  
11. 前往 TOS 控制面板 > 存储管理 > 卷 > 编辑 ，根据需求编辑卷容量。  
  
当你替换所有硬盘后,如果发现依然无法扩容存储池或卷,请参考这个指引,手动扩容:  
[viewtopic.php?f=88&t=1579](https://forum.terra-master.com/cn/viewtopic.php?f=88&t=1579)  
  
备注：  
阵列同步过程中会影响产品的性能，请勿此时做其它的操作。  
[![图片](https://s2.loli.net/2024/11/29/bKNRPiv6V1uadeT.png)](https://sm.ms/image/bKNRPiv6V1uadeT)

